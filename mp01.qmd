---
title: "STA 9750 Miniproject 1"
format: html
editor: visual
---

Netflix is one of the most popular streaming services in the word, with the company reporting approximately 90 million subscribers in Q4 2024. In this project, I will be analyzing the Top 10 Shows and Movies on Netflix at the given moment, and give commentary on the insights I found.

```{r}
#| echo: false 
#| include: false
#Run the project itself
options(repos = c(CRAN = "https://cloud.r-project.org"))
```

```{r}
#| echo: false 
#| include: false
install.packages("DT")
install.packages("stringr")
library(tibble)
```

```{r}
#| echo: false 
#| include: false
if(!dir.exists(file.path("data", "mp01"))){
  dir.create(file.path("data", "mp01"), showWarnings=FALSE, recursive=TRUE)
}

GLOBAL_TOP_10_FILENAME <- file.path("data", "mp01", "global_top10_alltime.csv")

if(!file.exists(GLOBAL_TOP_10_FILENAME)){
  download.file("https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv", 
                destfile=GLOBAL_TOP_10_FILENAME)
}

COUNTRY_TOP_10_FILENAME <- file.path("data", "mp01", "country_top10_alltime.csv")

if(!file.exists(COUNTRY_TOP_10_FILENAME)){
  download.file("https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv", 
                destfile=COUNTRY_TOP_10_FILENAME)
}

if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

GLOBAL_TOP_10 <- read_tsv(GLOBAL_TOP_10_FILENAME)

str(GLOBAL_TOP_10)

GLOBAL_TOP_10 <- GLOBAL_TOP_10 |>
  mutate(season_title = if_else(season_title == "N/A", NA, season_title))

COUNTRY_TOP_10 <- read_tsv(
  COUNTRY_TOP_10_FILENAME,
  na = "N/A"
)
str(COUNTRY_TOP_10)
str(GLOBAL_TOP_10)

library(DT)
GLOBAL_TOP_10 |> 
  head(n=20) |>
  datatable(options=list(searching=FALSE, info=FALSE))

#Format GLOBAL_TOP_10
library(stringr)
format_titles <- function(df){
  colnames(df) <- str_replace_all(colnames(df), "_", " ") |> str_to_title()
  df
}

GLOBAL_TOP_10 |> 
  format_titles() |>
  head(n=20) |>
  datatable(options=list(searching=FALSE, info=FALSE)) |>
  formatRound(c('Weekly Hours Viewed', 'Weekly Views'))

GLOBAL_TOP_10 |> 
  select(-season_title) |>
  format_titles() |>
  head(n=20) |>
  datatable(options=list(searching=FALSE, info=FALSE)) |>
  formatRound(c('Weekly Hours Viewed', 'Weekly Views'))

GLOBAL_TOP_10 |> 
    mutate(`runtime_(minutes)` = round(60 * runtime)) |>
    select(-season_title, 
           -runtime) |> 
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views', 'Runtime (Minutes)'))
```

### Question #1: How many countries is Netflix active in?

```{r}
num_countries <- COUNTRY_TOP_10 |>
  summarise(n_countries = n_distinct(country_name)) |> #Get total amount of countries in dataset
  pull(n_countries)

# Show the result
num_countries
```

-   As we can see Netflix is active in 94 countries!

### Question #2: Which non-English film spent the most cumulative weeks in the top 10? And for how many weeks?

```{r}
# Find the non-English-language film with most cumulative weeks
non_english_top <- GLOBAL_TOP_10 %>%
  filter(str_detect(category, "Films")) %>% #Filter only films
  filter(!str_detect(category, "Films(English)")) %>%   # keep only non-English films
  slice_max(cumulative_weeks_in_top_10, n = 1) %>% # pick the row with the highest value 
  select(show_title, cumulative_weeks_in_top_10) 

non_english_top
```

-   The most popular non-English film was All Quiet on the Western Front! It was Top 10 for 23 weeks in a row!

### Question #3: What is the longest film to have ever appeared in the Netflix Global Top 10? And How long was it in minutes?

```{r}
colnames(GLOBAL_TOP_10)

longest_film <- GLOBAL_TOP_10 %>%
  filter(str_detect(category, "Films")) %>% #Filter only films
  slice_max(runtime, n = 1) %>% # pick the film with longest runtime
  select(runtime, category, weekly_rank, week, show_title)
longest_film
```

-   The longest film to ever appear was Pushpa 2: The Rule. It runs for a total of 3.73 hours.

### Question #4: For each of the four categories, what program has the most total hours of global viewership?

```{r}
top_by_category <- GLOBAL_TOP_10 %>% 
  group_by(category, show_title) %>%
  summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE), .groups = "drop") %>% 
  slice_max(total_hours, n = 1, by = category)   # pick the top program per category

top_by_category
```

-   The top viewed shows for each category were:

    -   English Films: KPop Demon Hunters

    -   Non-English Films: Society of the Snow

    -   English TV: Stranger Things

    -   Non-English TV: Squid Game

### Question #5: Which TV show had the longest run in a countryâ€™s Top 10? How long was this run and in what country did it occur?

```{r}
longest_run <- COUNTRY_TOP_10 %>%
  group_by(country_name, show_title) %>%
  summarise(weeks_in_top10 = n(), .groups = "drop") %>% 
  arrange(desc(weeks_in_top10)) %>% #Show in descending order for the item with the absolute highest amount of weeks in top 10
  slice(1) #Slice to get the top result

longest_run

```

-   The show with the longest amount of weeks in the top 10 was Friends in Jordan!

### Question #6: Netflix provides over 200 weeks of service history for all but one country in our data set. Which country is this and when did Netflix cease operations in that country?

```{r}
#Count total number of **distinct weeks each country appears in the top 10
country_weeks <- COUNTRY_TOP_10 %>% 
  group_by(country_name) %>%
  summarise(total_weeks = n_distinct(week), .groups = "drop") %>% #Count unique weeks for each country
  arrange(total_weeks)

#Get the country with the **fewest total weeks** in the top 10
odd_country <- country_weeks %>% 
  slice(1) %>% 
  pull(country_name)

# Find the **most recent week** that this "odd" country appeared in the top 10
last_week <- COUNTRY_TOP_10 %>% 
  filter(country_name == odd_country) %>%
  summarise(last_week = max(week))

#Display country
odd_country
last_week
  

```

-   The country referred to is Russia, and Netflix service got removed in 2/27/2022

### Question #7. What is the total viewership of the TV show Squid Game? Note that there are three seasons total and we are looking for the total number of hours watched across all seasons.

```{r}
squid_game_hours <- GLOBAL_TOP_10 %>% 
  filter(str_detect(show_title, "Squid Game")) %>% 
  summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE)) #Get the total amount of hours viewed for Squid Game regardless of season

squid_game_hours
```

-   The total amount of hours viewed for Squid Game across all seasons is 5.31 billion hours

### Question #8: The movie Red Notice has a runtime of 1 hour and 58 minutes. Approximately how many views did it receive in 2021?

```{r}
red_notice_views <- GLOBAL_TOP_10 %>% 
  filter(show_title == "Red Notice", lubridate::year(week) ==  2021) %>% #Filter the year to only show 2021
  summarise(
    total_hours = sum(weekly_hours_viewed, na.rm = TRUE), #Get total hours watched
    est_views = total_hours / 1.97 #Divide total_hours by the movie length to get estimated amount of views
  )

red_notice_views
  
```

-   Red Notice received an estimated 201390863 views in 2021.

### Question #9: How many Films reached Number 1 in the US but did not originally debut there? That is, find films that first appeared on the Top 10 chart at, e.g., Number 4 but then became more popular and eventually hit Number 1? What is the most recent film to pull this off?

```{r}
#Filter dataset for US countries only
us_films <- COUNTRY_TOP_10 %>%
  filter(country_name == "United States") %>%
  filter(str_detect(category, "Films"))
      
# Summarise each film's ranking information
film_rankings <- us_films %>% 
  group_by(show_title) %>%
  summarise(
    debut_week = min(week, na.rm = TRUE), # The first week the film appeared in top 10
    debut_rank = weekly_rank[week == min(week, na.rm = TRUE)][1],
    best_rank = min(weekly_rank, na.rm = TRUE),
    most_recent_week_at_best = max(week[weekly_rank == min(weekly_rank, na.rm = TRUE)], na.rm = TRUE), #Most recent week it reached the best rank
    .groups = "drop"
  )

# Filter films that **climbed to #1** after debuting below #1
films_that_climbed <- film_rankings %>% 
  filter((debut_rank) > 1 & best_rank == 1) %>% 
    arrange(desc(most_recent_week_at_best)) # Sort so the most recent climbers are first

# View all films that climbed to #1
films_that_climbed

# Get the single most recent climber
most_recent_climber <- films_that_climbed %>%
  slice(1)   # top row after sorting by most recent week
most_recent_climber

# Count how many films climbed to #1 after debuting below #1
num_climbed <- nrow(films_that_climbed)
num_climbed
```

-   There were 45 films that debuted in the top 10 but eventually reached the #1 slot. The most recent film to achieve this was KPop Demon Hunters

## #10: Which TV show/season hit the top 10 in the most countries in its debut week? In how many countries did it chart?

```{r}
tv_data <- COUNTRY_TOP_10 %>% 
  filter(str_detect(category, "TV")) #Filter by TV Shows

# Find the debut week for each TV show season
tv_debuts <- tv_data %>% 
  group_by(show_title, season_title) %>% 
  summarise(
    debut_week = min(week, na.rm = TRUE),
    .groups = "drop"
  )

# Keep only rows corresponding to the debut week for each show-season
tv_with_debut <- tv_data %>% 
  inner_join(tv_debuts, by = c("show_title", "season_title", "week" = "debut_week")) # Joins original TV data with debut weeks: matches on show, season, and week = debut_week

# Count how many countries each show-season appeared in during its debut week
debut_reach <- tv_with_debut %>% 
  group_by(show_title, season_title, week) %>%
  summarise(
    num_countries = n_distinct(country_name),
    .groups = "drop"
  ) %>%
  arrange(desc(num_countries))

# Identify the TV show-season that debuted in the most countries
top_debut <- debut_reach %>%  slice(1) # Take the top row (highest debut reach)
top_debut
```

-   The TV show that hit top 10 in the most countries in its debut week was Emily in Paris, debuting in all 94 countries Netflix is active in!

## Press Release #1: Stranger Things: A Global Phenomenon Returns for its final season in 2025

Netflix's global hit series Stranger Things will return in 2025 for its highly anticipated final season, marking the conclusion of one of the most successful and influential franchises in TV history.

```{r}
# 1. Filter Stranger Things from GLOBAL_TOP_10
stranger_global <- GLOBAL_TOP_10 %>%
  filter(str_detect(show_title, "Stranger Things"))

# Total global hours viewed across all seasons
stranger_total_hours <- stranger_global %>%
  summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE))

# Total number of weeks in Global Top 10
stranger_total_weeks <- stranger_global %>%
  summarise(total_weeks = n_distinct(week))

# 2. Country-level analysis
stranger_country <- COUNTRY_TOP_10 %>%
  filter(str_detect(show_title, "Stranger Things"))

# Number of unique countries where Stranger Things appeared
stranger_total_countries <- stranger_country %>%
  summarise(num_countries = n_distinct(country_name))

# 3. Compare to other English-language TV shows
english_tv_global <- GLOBAL_TOP_10 %>%
  filter(str_detect(category, "TV (English)"))

comparison <- english_tv_global %>%
  group_by(show_title) %>%
  summarise(
    total_hours = sum(weekly_hours_viewed, na.rm = TRUE),
    total_weeks = n_distinct(week),
    .groups = "drop"
  ) %>%
  arrange(desc(total_hours))

# Peek at top 10 shows for context
top10_english_tv <- head(comparison, 10)

# Combine the single-value summaries into one row
stranger_summary <- tibble(
  total_hours = stranger_total_hours$total_hours,
  total_weeks = stranger_total_weeks$total_weeks,
  total_countries = stranger_total_countries$num_countries
)

stranger_summary
top10_english_tv
```

-   Stranger Things comes back strong in 2025 with a highly-anticipated final season, with 296780000 hours being watched collectively across 4 seasons

-   Stranger Things experienced 20 weeks in the top 10

-   Stranger Things experienced global top 10 popularity in every single country Netflix is active in.

## Press Release #2: Netflix in India: Record-Breaking growth in World's Largest Country

Netflix announced record-breaking growth in India, the world's largest country, underscoring its expanding reach and strengthening its position in one of the fastest-growing entertainment markets.

```{r}
# Filter for Indian Top 10
india_top <- COUNTRY_TOP_10 %>%
  filter(country_name == "India")

india_with_global <- india_top %>%
  inner_join(
    GLOBAL_TOP_10 %>% 
      select(show_title, runtime, `runtime`, weekly_hours_viewed, weekly_views, week),
    by = c("show_title", "week") # match by show title + week
  )

library(lubridate)

india_views_by_year <- india_with_global %>%
  mutate(year = year(week)) %>%   # extract the year from the week column
  group_by(year) %>%
  summarise(
    total_hours_viewed = sum(weekly_hours_viewed, na.rm = TRUE),
    total_views = sum(weekly_views, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(year)

india_summary <- india_with_global %>%
  group_by(show_title, category) %>%
  summarise(
    total_hours_viewed = sum(weekly_hours_viewed, na.rm = TRUE),
    total_weeks_in_top10 = n_distinct(week),
    runtime_hours = max(runtime, na.rm = TRUE),   # runtime is already in hours
    est_views = total_hours_viewed / runtime_hours,  # total hours / hours per view
    .groups = "drop"
  ) %>%
  arrange(desc(total_hours_viewed))

india_summary
india_views_by_year
```

-   Netflix's presence in India has exploded since its deployment, seeing a massive surge in show viewership from 2.4 billion to 4.5 billion from 2023-2024

-   Netflix saw its highest level of consumption of content in 2022 in India, with over 330 billion hours of content viewed

-   While total viewership slightly declined between 2024-2025, Netflix's Indian market is expected to remain stable in the long-run

## Press Release 3: A Celebration of Success for Korean Netflix TV

Netflix celebrates the success of its expansion to Korea, celebrating record viewership, critical acclaim, and the continued power of the Korean demographic as well as the demand for Korean content.

```{r}
# Filter for Korean-origin shows in Global Top 10
kdrama_global <- COUNTRY_TOP_10 %>%
  filter(str_detect(country_name, "Korea"))

# Join with GLOBAL_TOP_10 to get global hours/views info
kdrama_combined <- kdrama_global %>%
  inner_join(
    GLOBAL_TOP_10 %>%
      select(show_title, week, weekly_hours_viewed, weekly_views, runtime, category),
    by = c("show_title", "week")
  )
# Filter only TV shows
kdrama_tv <- kdrama_combined %>%
  filter(str_detect(category.x, "TV"))  # keep only TV shows

# Summarize top Korean TV shows globally
top_kdramas_tv <- kdrama_tv %>%
  group_by(country_name, show_title) %>%  # group by show title only
  summarise(
    total_hours = sum(weekly_hours_viewed, na.rm = TRUE),
    total_views = sum(weekly_views, na.rm = TRUE),
    total_weeks = n_distinct(week),
    .groups = "drop"
  ) %>%
  arrange(country_name, desc(total_hours)) %>%  # sort by total hours viewed
  slice_head(n = 10)              # top 10

top_kdramas_tv




```

-   TV Shows are taking Korea by storm â€” *Squid Game* alone has dazzled audiences with over 683 million views

-   Global shows continue to rank up popularity in South Korea, from *Extraordinary Attorney Woo* to *All of Us Are Dead*, Korean audiences are spending millions of hours streaming their favorite TV hits

-   Squid Game remains the most impactful show, having remained top 10 popularity status for 27 weeks in total

### Conclusion:

Netflix continues to be a prime contender as one of the world's leading streaming services worldwide, with its portfolio still raking many hits such as Squid Game, KPop Demon Hunters, and Stranger Things. Notable, Korean-inspired content seems to be trending greatly, with Squid Game having being the single most viewed show on Netflix to this date and KPop Demon Hunters being the most viewed English film. If I were to make one recommendation from my insights, investing into Korean-inspired content is a strong strategy, as it aligns with audience viewing trends and will help maintain Netflix's global reach in the long run.
